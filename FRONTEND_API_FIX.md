# å‰ç«¯APIé…ç½®ä¿®å¤æŒ‡å—

## é—®é¢˜æè¿°
ç”¨æˆ·åœ¨UbuntuæœåŠ¡å™¨ä¸Šè®¿é—® `http://172.237.20.24:3000/gemini` æ—¶ï¼Œå‰ç«¯å‘é€çš„APIè¯·æ±‚ä»ç„¶æŒ‡å‘ `http://localhost:8001`ï¼Œå¯¼è‡´Gemini Keyæµ‹è¯•å’Œä¿å­˜å¤±è´¥ã€‚

## é—®é¢˜åŽŸå› 
1. å‰ç«¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå¯èƒ½æ²¡æœ‰æ­£ç¡®æ£€æµ‹åˆ°ç”Ÿäº§çŽ¯å¢ƒ
2. æµè§ˆå™¨ç¼“å­˜äº†æ—§çš„APIé…ç½®
3. å‰ç«¯æœåŠ¡æ²¡æœ‰ä½¿ç”¨æ­£ç¡®çš„çŽ¯å¢ƒå˜é‡

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨è‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼ˆæŽ¨èï¼‰
åœ¨UbuntuæœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
# ä¸‹è½½å¹¶è¿è¡Œä¿®å¤è„šæœ¬
wget https://raw.githubusercontent.com/your-repo/aiagent/main/fix-frontend-api-config.sh
chmod +x fix-frontend-api-config.sh
./fix-frontend-api-config.sh
```

### æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨ä¿®å¤

#### æ­¥éª¤1ï¼šåœæ­¢çŽ°æœ‰å‰ç«¯æœåŠ¡
```bash
pm2 stop aiagent-frontend
pm2 delete aiagent-frontend
```

#### æ­¥éª¤2ï¼šé…ç½®çŽ¯å¢ƒå˜é‡
```bash
cd frontend/b-end
cat > .env << EOF
VITE_API_BASE_URL=http://172.237.20.24:8001
VITE_NODE_ENV=production
VITE_SERVER_IP=172.237.20.24
EOF
```

#### æ­¥éª¤3ï¼šé‡æ–°æž„å»ºå‰ç«¯
```bash
npm install
npm run build
```

#### æ­¥éª¤4ï¼šå¯åŠ¨å‰ç«¯æœåŠ¡
```bash
pm2 start --name "aiagent-frontend" npm -- run preview -- --port 3000 --host 0.0.0.0
pm2 save
```

### æ–¹æ¡ˆ3ï¼šå¿«é€Ÿæµ‹è¯•ä¿®å¤
å¦‚æžœåªæ˜¯æƒ³å¿«é€Ÿæµ‹è¯•ï¼Œå¯ä»¥ç›´æŽ¥ä¿®æ”¹å‰ç«¯ä»£ç ï¼š

1. ç¼–è¾‘ `frontend/b-end/src/services/api.ts`
2. å°† `API_BASE_URL` ç¡¬ç¼–ç ä¸ºï¼š
```javascript
const API_BASE_URL = 'http://172.237.20.24:8001';
```
3. é‡æ–°æž„å»ºå¹¶å¯åŠ¨å‰ç«¯

## éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥å‰ç«¯æœåŠ¡çŠ¶æ€
```bash
pm2 list
pm2 logs aiagent-frontend --lines 20
```

### 2. æµ‹è¯•å‰ç«¯è®¿é—®
```bash
curl http://172.237.20.24:3000
```

### 3. æ£€æŸ¥APIé…ç½®
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œè®¿é—® `http://172.237.20.24:3000/gemini`ï¼Œåœ¨Consoleä¸­åº”è¯¥çœ‹åˆ°ï¼š
```
ðŸ”§ API Configuration: {
  hostname: "172.237.20.24",
  isDevelopment: false,
  API_BASE_URL: "http://172.237.20.24:8001",
  envVar: "http://172.237.20.24:8001"
}
```

### 4. æµ‹è¯•Gemini API
åœ¨Geminié…ç½®é¡µé¢æµ‹è¯•API Keyï¼ŒNetworkæ ‡ç­¾ä¸­åº”è¯¥çœ‹åˆ°è¯·æ±‚å‘é€åˆ°ï¼š
`http://172.237.20.24:8001/api/v1/ai-models/gemini/test`

## æ•…éšœæŽ’é™¤

### å¦‚æžœAPIè¯·æ±‚ä»ç„¶æŒ‡å‘localhost
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒCookie
2. ä½¿ç”¨æ— ç—•æ¨¡å¼è®¿é—®
3. æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦æ­£ç¡®åˆ›å»º
4. ç¡®è®¤å‰ç«¯é‡æ–°æž„å»ºæˆåŠŸ

### å¦‚æžœå‰ç«¯æ— æ³•è®¿é—®
1. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼š`sudo ufw status`
2. ç¡®è®¤ç«¯å£3000å·²å¼€æ”¾ï¼š`sudo ufw allow 3000`
3. æ£€æŸ¥PM2æœåŠ¡çŠ¶æ€ï¼š`pm2 list`

### å¦‚æžœAPIè¯·æ±‚å¤±è´¥
1. ç¡®è®¤åŽç«¯APIæœåŠ¡è¿è¡Œæ­£å¸¸ï¼š`curl http://172.237.20.24:8001/api/v1/health`
2. æ£€æŸ¥CORSé…ç½®æ˜¯å¦åŒ…å«å‰ç«¯åœ°å€
3. æŸ¥çœ‹åŽç«¯æ—¥å¿—ï¼š`pm2 logs aiagent-api --lines 50`

## é‡è¦æç¤º
- ç¡®ä¿åŽç«¯APIæœåŠ¡è¿è¡Œåœ¨8001ç«¯å£
- ç¡®ä¿CORSé…ç½®åŒ…å« `http://172.237.20.24:3000`
- ä¿®å¤åŽéœ€è¦æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- å»ºè®®ä½¿ç”¨HTTPSåœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­