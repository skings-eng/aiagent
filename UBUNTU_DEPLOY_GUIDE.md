# Ubuntu éƒ¨ç½²æŒ‡å— - æ™ºèƒ½æŠ•èµ„åŠ©æ‰‹

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨UbuntuæœåŠ¡å™¨ä¸Šéƒ¨ç½²å·²ä¿®å¤çš„æ™ºèƒ½æŠ•èµ„åŠ©æ‰‹é¡¹ç›®ã€‚ä»£ç å·²ç»ä¿®å¤äº†æ‰€æœ‰æ„å»ºé”™è¯¯ï¼Œå¯ä»¥ç›´æ¥éƒ¨ç½²ã€‚

## ğŸ“‹ å‰ææ¡ä»¶

- Ubuntu 20.04+ æœåŠ¡å™¨
- è‡³å°‘ 2GB å†…å­˜
- è‡³å°‘ 10GB ç¡¬ç›˜ç©ºé—´
- å…¬ç½‘IPåœ°å€
- sudoæƒé™

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè¿æ¥åˆ°UbuntuæœåŠ¡å™¨

```bash
# SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh ubuntu@ä½ çš„æœåŠ¡å™¨IP
# æˆ–è€…
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

### ç¬¬äºŒæ­¥ï¼šæ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…åŸºç¡€ä¾èµ–

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y curl wget git build-essential software-properties-common
```

### ç¬¬ä¸‰æ­¥ï¼šå…‹éš†æœ€æ–°ä»£ç 

```bash
# è¿›å…¥ç”¨æˆ·ä¸»ç›®å½•
cd ~

# å…‹éš†é¡¹ç›®ï¼ˆä½¿ç”¨æœ€æ–°ä¿®å¤çš„ä»£ç ï¼‰
git clone https://github.com/skings-eng/aiagent.git
cd aiagent

# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x *.sh
```

### ç¬¬å››æ­¥ï¼šè¿è¡Œä¸€é”®å®‰è£…è„šæœ¬

```bash
# è¿è¡ŒUbuntuå®‰è£…è„šæœ¬
./install-ubuntu.sh
```

**å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š**
- âœ… Node.js 18.x å®‰è£…
- âœ… Python 3.11+ å®‰è£…
- âœ… MongoDB å®‰è£…å’Œé…ç½®
- âœ… Redis å®‰è£…å’Œé…ç½®
- âœ… PM2 è¿›ç¨‹ç®¡ç†å™¨å®‰è£…
- âœ… é¡¹ç›®ä¾èµ–å®‰è£…
- âœ… é˜²ç«å¢™é…ç½®

### ç¬¬äº”æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

#### 5.1 é…ç½®åç«¯API

```bash
# ç¼–è¾‘åç«¯APIé…ç½®
nano backend/api/.env
```

**æœ€å°é…ç½®ç¤ºä¾‹ï¼š**
```env
# åŸºç¡€é…ç½®
NODE_ENV=production
PORT=3001
SERVER_HOST=0.0.0.0

# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://localhost:27017/japan-stock-ai
REDIS_HOST=localhost
REDIS_PORT=6379

# CORSé…ç½®ï¼ˆæ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨IPï¼‰
FRONTEND_URL=http://ä½ çš„æœåŠ¡å™¨IP:4173
ALLOWED_ORIGINS=http://ä½ çš„æœåŠ¡å™¨IP:4173

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-$(date +%s)
JWT_EXPIRES_IN=7d

# AI APIå¯†é’¥ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰
GOOGLE_AI_API_KEY=ä½ çš„Google_AI_APIå¯†é’¥
# OPENAI_API_KEY=ä½ çš„OpenAI_APIå¯†é’¥
# ANTHROPIC_API_KEY=ä½ çš„Claude_APIå¯†é’¥

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
EOF
```

#### 5.2 é…ç½®LINE Botï¼ˆå¯é€‰ï¼‰

```bash
# ç¼–è¾‘LINEé…ç½®
nano backend/line/.env
```

**LINEé…ç½®ç¤ºä¾‹ï¼š**
```env
# åŸºç¡€é…ç½®
NODE_ENV=production
PORT=3003
SERVER_HOST=0.0.0.0

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379

# LINE Boté…ç½®ï¼ˆå¦‚æœæœ‰LINE Botï¼‰
LINE_CHANNEL_ACCESS_TOKEN=ä½ çš„LINE_ACCESS_TOKEN
LINE_CHANNEL_SECRET=ä½ çš„LINE_CHANNEL_SECRET
LINE_WEBHOOK_URL=https://ä½ çš„åŸŸåæˆ–IP:3003/webhook

# APIé…ç½®
API_BASE_URL=http://localhost:3001

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
```

#### 5.3 é…ç½®å‰ç«¯

```bash
# ç¼–è¾‘å‰ç«¯é…ç½®
nano frontend/b-end/.env
```

**å‰ç«¯é…ç½®ç¤ºä¾‹ï¼š**
```env
# APIé…ç½®ï¼ˆæ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨IPï¼‰
VITE_API_BASE_URL=http://ä½ çš„æœåŠ¡å™¨IP:3001
VITE_WS_URL=ws://ä½ çš„æœåŠ¡å™¨IP:3001

# ç¯å¢ƒé…ç½®
VITE_NODE_ENV=production
```

### ç¬¬å…­æ­¥ï¼šæ„å»ºå’Œå¯åŠ¨æœåŠ¡

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-services.sh --with-frontend
```

### ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
pm2 logs

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep -E ':(3001|3003|4173)'
```

**é¢„æœŸè¾“å‡ºï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name           â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ aiagent-api    â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 12345    â”‚ 5m     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 50.0mb   â”‚ ubuntu   â”‚ disabled â”‚
â”‚ 1   â”‚ aiagent-line   â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 12346    â”‚ 5m     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 30.0mb   â”‚ ubuntu   â”‚ disabled â”‚
â”‚ 2   â”‚ aiagent-frontendâ”‚ default    â”‚ 1.0.0   â”‚ fork    â”‚ 12347    â”‚ 5m     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 20.0mb   â”‚ ubuntu   â”‚ disabled â”‚
â”‚ 3   â”‚ aiagent-mcp    â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 12348    â”‚ 5m     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 25.0mb   â”‚ ubuntu   â”‚ disabled â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¬¬å…«æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 22      # SSH
sudo ufw allow 3001    # API
sudo ufw allow 3003    # LINE Bot
sudo ufw allow 4173    # å‰ç«¯

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

## ğŸŒ è®¿é—®åº”ç”¨

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **å‰ç«¯ç•Œé¢**: http://ä½ çš„æœåŠ¡å™¨IP:4173
- **APIæ–‡æ¡£**: http://ä½ çš„æœåŠ¡å™¨IP:3001/api-docs
- **LINE Webhook**: http://ä½ çš„æœåŠ¡å™¨IP:3003/webhook

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ„å»ºå¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜é‡æ–°æ„å»º
npm run clean
npm install
npm run build
```

### 2. æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs aiagent-api
pm2 logs aiagent-line
pm2 logs aiagent-frontend

# é‡å¯æœåŠ¡
pm2 restart all
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MongoDBçŠ¶æ€
sudo systemctl status mongod

# é‡å¯MongoDB
sudo systemctl restart mongod

# æ£€æŸ¥RedisçŠ¶æ€
sudo systemctl status redis-server
```

### 4. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tlnp | grep :3001

# æ€æ­»å ç”¨è¿›ç¨‹
sudo fuser -k 3001/tcp
```

## ğŸ”„ æ›´æ–°ä»£ç 

å½“GitHubä¸Šæœ‰æ–°çš„ä»£ç æ›´æ–°æ—¶ï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/aiagent

# åœæ­¢æœåŠ¡
./stop-services.sh

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°æ„å»ºå’Œå¯åŠ¨
npm run build
./start-services.sh --with-frontend
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹ç³»ç»Ÿèµ„æº

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

### PM2 ç›‘æ§

```bash
# PM2 ç›‘æ§é¢æ¿
pm2 monit

# æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…
pm2 show aiagent-api

# é‡å¯ç‰¹å®šæœåŠ¡
pm2 restart aiagent-api
```

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼ä½ å·²ç»æˆåŠŸåœ¨UbuntuæœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†æ™ºèƒ½æŠ•èµ„åŠ©æ‰‹ã€‚

**é‡è¦æé†’ï¼š**
1. å°†æ–‡æ¡£ä¸­çš„ `ä½ çš„æœåŠ¡å™¨IP` æ›¿æ¢ä¸ºå®é™…çš„æœåŠ¡å™¨IPåœ°å€
2. ç¡®ä¿é…ç½®äº†è‡³å°‘ä¸€ä¸ªAI APIå¯†é’¥
3. å®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®
4. ç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€

ç°åœ¨å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® http://ä½ çš„æœåŠ¡å™¨IP:4173 å¼€å§‹ä½¿ç”¨AIæŠ•èµ„åŠ©æ‰‹äº†ï¼